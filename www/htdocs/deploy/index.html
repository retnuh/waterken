<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Deployment Tips: Configuring the Waterken server</title>
<link rel="StyleSheet" type="text/css" href="../res/style.css">
<link rel="icon" type="image/gif" href="../res/icon.gif">
</head>
<body>
<div class="navigation">
<a href="../"><img alt="home" src="../res/icon.gif" width="16" height="16" border="0"></a>
<span class="heading">&rarr; Deployment Tips</span>
</div>
<div class="main">
<h1><a name="title" href="#title">Configuring the Waterken<sup>TM</sup> server</a></h1>
<h2><a name="setup" href="#setup">Setup</a></h2>
<p>When the
<a href="http://sourceforge.net/project/platformdownload.php?group_id=93988">waterken-server</a>
distribution is unpacked, it creates an installation which is ready to be used.
This default setup can be configured in various ways to match your desired
deployment. This section explains the provided configuration options. You can
<a href="#using">skip to the section on using</a> the server if you're content
to use the provided setup.</p>
<h3><a name="system_properties" href="#system_properties">Java system properties</a></h3>
<p>To bootstrap its configuration, the server needs to know the locations of the
following folders:</p>
<dl>
<dt><code><a name="config" href="#config">config</a></code></dt>
<dd>holds configuration files, such as the SSL key pair</dd>
<dt><code><a name="db" href="#db">db</a></code></dt>
<dd>holds persistent Java objects</dd>
<dt><code><a name="code" href="#code">code</a></code></dt>
<dd>holds project specific Java class files
<p>This folder is expected to contain an entry for each project. For example,
the Waterken server includes a project named "example", so the <code>code</code>
folder includes a sub-folder named <code>example/bin/</code>.</p>
</dd>
</dl>
<p>By default, the server will assume the current working directory should be
used as the <code>code</code> folder.  The other folders are then expected to be
in immediate sub-folders.  This folder layout is the one created when you unpack
the waterken-server distribution.</p>
<p>This default folder layout can be customized using Java system properties.  A
Java system property can be defined using a "<code>-D</code>" option to the
<code>java</code> command used to start a JVM.</p>
<dl>
<dt><code><a name="waterken.home" href="#waterken.home">waterken.home</a></code></dt>
<dd>use the specified folder as the <code>home</code> folder (defaults to the
current working directory)</dd>
<dt><code><a name="waterken.config" href="#waterken.config">waterken.config</a></code></dt>
<dd>use the specified folder as the <code>config</code> folder (defaults to the
"config" sub-folder of the <code>waterken.home</code> folder)</dd>
<dt><code><a name="waterken.db" href="#waterken.db">waterken.db</a></code></dt>
<dd>use the specified folder as the <code>db</code> folder (defaults to the "db"
sub-folder of the <code>waterken.home</code> folder)</dd>
<dt><code><a name="waterken.code" href="#waterken.code">waterken.code</a></code></dt>
<dd>use the specified folder as the <code>code</code> folder (defaults to the
<code>waterken.home</code> folder)</dd>
<dt><code><a name="waterken.bin" href="#waterken.bin">waterken.bin</a></code></dt>
<dd>use the specified string as the extension to be added to a project name to
get the name of the folder, or JAR file, containing the project's class files
(defaults to "/bin/")
</dl>
<h3><a name="config_files" href="#config_files"><code>config</code> files</a></h3>
<p>All remaining configuration is expressed by files in the <code>config</code>
folder. The various <code>*.json</code> files in this folder are used to
initialize the HTTP request routing code. For example, settings of interest
include:</p>
<dl>
<dt><a name="www" href="#www"><code>www</code> folder</a></dt>
<dd>The <code>next.next.root</code> setting provides the path to a folder
containing files to be served, such as CSS files and Javascript.  By default,
this setting refers to the <code>www</code> folder created by the
waterken-server distribution.</dd>
<dt><a name="MIME" href="#MIME">known MIME types</a></dt>
<dd>The <code>next.next.MIME</code> setting provides an array of known MIME
types to be consulted when serving files from the <code>www</code> folder.</dd>
</dl>
<h2><a name="using" href="#using">Using the server</a></h2>
<p>The server can host two kinds of resources: files and Java objects. This
section shows how to add new resources to the server.</p>
<h3><a name="new_files" href="#new_files">Adding served files</a></h3>
<p>The content of any file under the <code><a href="#www">www/</a></code> folder
can be fetched using a URL whose path names the file. For example, your site's
homepage is at <code>www/index.html</code> and can be fetched using the URL:
<code>&lt;<a href="http://localhost:8080/index.html">http://localhost:8080/index.html</a>&gt;</code>.
</p>
<p>By convention, the <code>www/res/</code> folder is reserved for shared
content, such as stylesheets, images and Javascript code, that is referenced by
many other resources. This folder also provides the content served for HTTP
error codes. For example, the <code>www/res/404.html</code> file provides the
default content for any HTTP <code>404</code> error pages returned by the
server.</p>
<h3><a name="new_model" href="#new_model">Adding a new model</a></h3>
<p>Persistent Java objects hosted by the Waterken server are grouped into
collections, each of which is called a "model". The persistent state of each
model is held in a sub-folder of the <code><a href="#db">db/</a></code> folder.
You can create a new model from the command line using <code>share.jar</code>:
</p>
<p><kbd>java -jar share.jar example org.waterken.bang.Main test</kbd></p>
<p>The above command enables execution of the
<a href="../javadoc/org/web_send/graph/Publisher.html#spawn(java.lang.String,%20java.lang.Class)">Publisher#spawn()</a>
method from the command line. The last argument is the model name and the second
to last is the fully qualified name of the maker class used to construct the
first application object in the new model. The web-key for the created object is
returned on the <code>stdout</code> of the <code>share.jar</code> command. The
first argument to the <code>share.jar</code> command is the name of the project
that defines the maker class.</p>
<h3><a name="new_project" href="#new_project">Adding a new project</a></h3>
<p>Each model is associated with a given project in the
<code><a href="#code">code</a></code> folder where the application specific code
for that model is kept. For each project, there's also a default web page.</p>
</div>
<p class="footer">
</p>
</body>
</html>
